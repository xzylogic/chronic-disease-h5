<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>随访报告</title>
  <link rel="stylesheet" type="text/css" href="../lib/css/weui.min.css"/>
  <link rel="stylesheet" type="text/css" href="../lib/css/jquery-weui.css"/>
  <link rel="stylesheet" type="text/css" href="../custom/css/common.css"/>
  <link rel="stylesheet" type="text/css" href="../custom/css/report.css"/>

</head>

<body>
<div class="reportBox">
  <div class="tabWrap">
    <span class="current">筛查报告<em>()</em></span><span>随访报告<em>()</em></span>
  </div>

  <div class="have-data-wrap" style="padding-top: 1.4rem;">
    <p class="border-top"></p>
    <ul class="followUpReportList">
      <!--<li class="showItem">
        <div class="item" onclick="">
          <span class="date">2019-09-11&nbsp;&nbsp;筛查医生：黄小珊</span>
          <h5><span class="max-hei">黄陂顿饭霍可可医院</span></h5>
        </div>
        <div class="showDetail" style="display:block;">
          <div class="detailItem">
            <h5>检查信息</h5>
            <p>
              <em>空腹末稍血糖</em>12.33 mmol/L<br/>
              <em>空腹静脉血糖</em>0.9 mmol/L<br/>
              <em>DGTT2h静脉血糖</em>0.1 mmol/L<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>糖尿病危险因素</h5>
            <p>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>筛查结果</h5>
            <p>
              1、空腹血糖 7.0mmol/L<br/>
              2、餐后两小时血糖OGTT<br/>
              3、糖化血红蛋白：7.0%<br/>
            </p>
          </div>
        </div>
      </li>
      <li>
        <div class="item" onclick="">
          <span class="date">2019-09-11 &nbsp;筛查医生：黄小珊</span>
          <h5><span class="max-hei">黄陂顿饭霍可可医院</span></h5>
        </div>
        <div class="showDetail" style="display:none;">
          <div class="detailItem">
            <h5>检查信息</h5>
            <p>
              <em>空腹末稍血糖</em>12.33 mmol/L<br/>
              <em>空腹静脉血糖</em>0.9 mmol/L<br/>
              <em>DGTT2h静脉血糖</em>0.1 mmol/L<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>糖尿病危险因素</h5>
            <p>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>筛查结果</h5>
            <p>
              1、空腹血糖 7.0mmol/L<br/>
              2、餐后两小时血糖OGTT<br/>
              3、糖化血红蛋白：7.0%<br/>
            </p>
          </div>
        </div>
      </li>
      <li>
        <div class="item" onclick="">
          <span class="date">2019-09-11 &nbsp;筛查医生：黄小珊</span>
          <h5><span class="max-hei">黄陂顿饭霍可可医院</span></h5>
        </div>
        <div class="showDetail" style="display:none;">
          <div class="detailItem">
            <h5>检查信息</h5>
            <p>
              <em>空腹末稍血糖</em>12.33 mmol/L<br/>
              <em>空腹静脉血糖</em>0.9 mmol/L<br/>
              <em>DGTT2h静脉血糖</em>0.1 mmol/L<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>糖尿病危险因素</h5>
            <p>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
              1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>筛查结果</h5>
            <p>
              1、空腹血糖 7.0mmol/L<br/>
              2、餐后两小时血糖OGTT<br/>
              3、糖化血红蛋白：7.0%<br/>
            </p>
          </div>
        </div>
      </li>-->
    </ul>
  </div>

  <div class="have-data-wrap" style="padding-top: 1.4rem; display: none;">
    <p class="border-top"></p>
    <ul class="followUpReportList">
      <!--<li class="showItem">
        <div class="item" onclick="">
          <span class="date">2019-09-11&nbsp;&nbsp;随访医生：黄小珊</span>
          <h5><span class="max-hei">黄陂顿饭霍可可医院</span></h5>
        </div>
        <div class="showDetail" style="display:block;">
          <div class="detailItem detailItemSpecial">
            <p>
              <em>随访方式</em>门诊<br/>
              <em>随访状态</em>继续随访<br/>
              <em>预约下次随访时间</em>2019-01-09<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>糖尿病临床症状</h5>
            <p>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
            </p>
          </div>
          <div class="detailItem">
            <h5>检查信息</h5>
            <p>
              1、空腹血糖 7.0mmol/L<br/>
              2、餐后两小时血糖OGTT<br/>
              3、糖化血红蛋白：7.0%<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>随访建议</h5>
            <p>
              建议多运动，多吃水果，每三个月随访一次
            </p>
          </div>
          <div class="detailItem">
            <h5>其他随访建议</h5>
            <p>
              其他
            </p>
          </div>
        </div>
      </li>
      <li>
        <div class="item" onclick="">
          <span class="date">2019-09-11&nbsp;&nbsp;随访医生：黄小珊</span>
          <h5><span class="max-hei">黄陂顿饭霍可可医院</span></h5>
        </div>
        <div class="showDetail" style="display:none;">
          <div class="detailItem detailItemSpecial">
            <p>
              <em>随访方式</em>门诊<br/>
              <em>随访状态</em>继续随访<br/>
              <em>预约下次随访时间</em>2019-01-09<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>糖尿病临床症状</h5>
            <p>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
            </p>
          </div>
          <div class="detailItem">
            <h5>检查信息</h5>
            <p>
              1、空腹血糖 7.0mmol/L<br/>
              2、餐后两小时血糖OGTT<br/>
              3、糖化血红蛋白：7.0%<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>随访建议</h5>
            <p>
              建议多运动，多吃水果，每三个月随访一次
            </p>
          </div>
          <div class="detailItem">
            <h5>其他随访建议</h5>
            <p>
              其他
            </p>
          </div>
        </div>
      </li>
      <li>
        <div class="item" onclick="">
          <span class="date">2019-09-11&nbsp;&nbsp;随访医生：黄小珊</span>
          <h5><span class="max-hei">黄陂顿饭霍可可医院</span></h5>
        </div>
        <div class="showDetail" style="display:none;">
          <div class="detailItem detailItemSpecial">
            <p>
              <em>随访方式</em>门诊<br/>
              <em>随访状态</em>继续随访<br/>
              <em>预约下次随访时间</em>2019-01-09<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>糖尿病临床症状</h5>
            <p>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
              <span>1、高血压（收缩压>140和(或)舒张压>90mmHg)<br/></span>
            </p>
          </div>
          <div class="detailItem">
            <h5>检查信息</h5>
            <p>
              1、空腹血糖 7.0mmol/L<br/>
              2、餐后两小时血糖OGTT<br/>
              3、糖化血红蛋白：7.0%<br/>
            </p>
          </div>
          <div class="detailItem">
            <h5>随访建议</h5>
            <p>
              建议多运动，多吃水果，每三个月随访一次
            </p>
          </div>
          <div class="detailItem">
            <h5>其他随访建议</h5>
            <p>
              其他
            </p>
          </div>
        </div>
      </li>-->
    </ul>
  </div>

  <div class='custom-nodata' style="display:none;">
    <img src="../custom/images/nodata.png">
    <p>暂无报告</p>
  </div>
</div>
<script type="text/template" id="screening-Temp">
  <li>
    <div class="item">
      <span class="date">{0}&nbsp;&nbsp;筛查医生：{1}</span>
      <h5><span class="max-hei">{2}</span></h5>
    </div>
    <div class="showDetail" style="display:none;">
      <div class="detailItem">
        <h5>检查信息</h5>
        <p>
          <em>空腹末稍血糖</em>{3}<br/>
          <em>空腹静脉血糖</em>{4}<br/>
          <em>DGTT2h静脉血糖</em>{5}<br/>
        </p>
      </div>
      <div class="detailItem">
        <h5>糖尿病危险因素</h5>
        <p>
          {6}
        </p>
      </div>
      <div class="detailItem">
        <h5>筛查结果</h5>
        <p>
          {7}<br/>
        </p>
      </div>
    </div>
  </li>
</script>
<script type="text/template" id="follow-Temp">
  <li>
    <div class="item">
      <span class="date">{0}&nbsp;&nbsp;随访医生：{1}</span>
      <h5><span class="max-hei">{2}</span></h5>
    </div>
    <div class="showDetail" style="display:none;">
      <div class="detailItem detailItemSpecial">
        <p>
          <em>随访方式</em>{3}<br/>
          <em>随访状态</em>{4}<br/>
          <em>预约下次随访时间</em>{5}<br/>
        </p>
      </div>
      <div class="detailItem">
        <h5>糖尿病临床症状</h5>
        <p>
          {6}
        </p>
      </div>
      <div class="detailItem">
        <h5>检查信息</h5>
        <p>
          1、空腹血糖：{7}<br/>
          2、餐后两小时血糖OGTT：{8}<br/>
          3、糖化血红蛋白：{9}<br/>
        </p>
      </div>
      <div class="detailItem">
        <h5>随访建议</h5>
        <p>
          {10}
        </p>
      </div>
      <div class="detailItem">
        <h5>其他随访建议</h5>
        <p>
          {11}
        </p>
      </div>
    </div>
  </li>
</script>
<script type="text/javascript" src="../lib/js/flexible.js"></script>
<script type="text/javascript" src="../lib/js/fastclick.min.js"></script>
<script type="text/javascript" src="../lib/js/jquery.min.js"></script>
<script type="text/javascript" src="../custom/js/native.js"></script>
<script type="text/javascript" src="../custom/js/common.js"></script>
<script src="../custom/js/api.js"></script>
<script>
  FastClick.attach(document.body);
  $(function () {
    showMyloading();

    //获取筛查报告列表
    function getReportScreening() {
      //统计报告数
      // $.ajax({
      //   url: ajaxUrl.reportNum + '?uid=' + localStorage.getItem('uid'),
      //   type: "GET",
      //   beforeSend: function (request) {
      //     request.setRequestHeader('token', localStorage.getItem('netToken'));
      //     request.setRequestHeader('channelCode', localStorage.getItem('channelCode'));
      //     request.setRequestHeader('lightAppCode', localStorage.getItem('lightAppCode'));
      //     request.setRequestHeader('appid', localStorage.getItem('appid'));
      //     request.setRequestHeader('request-id', randomWord(true));
      //     request.setRequestHeader('timestamp', new Date().getTime());
      //   },
      //   success: function (data) {
      //     console.log('统计报告数:',data);
      //     if(data.code === 0){
      //       $('.tabWrap em:eq(0)').text('('+ data.data.screeningNum +')');
      //       $('.tabWrap em:eq(1)').text('('+ data.data.followNum +')');
      //     }else{
      //       $.toast(data.msg || '请求错误~', 'text');
      //     }
      //     hideMyloading();
      //     // resolve('帅查报告列表');
      //   },
      //   error: function (err) {
      //     hideMyloading();
      //     console.log(err);
      //   }
      // });
      return new Promise(function (resolve, reject) {
        $.ajax({
          url: ajaxUrl.reportScreening + '?cardType=01&cardNumber='+ localStorage.getItem('idcard') +'&registerId=' + localStorage.getItem('uid'),
          type: "GET",
          beforeSend: function (request) {
            request.setRequestHeader('token', localStorage.getItem('netToken'));
            request.setRequestHeader('channelCode', localStorage.getItem('channelCode'));
            request.setRequestHeader('lightAppCode', localStorage.getItem('lightAppCode'));
            request.setRequestHeader('appid', localStorage.getItem('appid'));
            request.setRequestHeader('request-id', randomWord(true));
            request.setRequestHeader('timestamp', new Date().getTime());
          },
          success: function (data) {
            console.log('筛查报告列表:',data);
            if(data.code === 0){
              $('.tabWrap em:eq(0)').text('('+ data.data.length +')');
              resolve(data.data);
            }else{
              $.toast(data.msg || '请求错误~', 'text');
            }
            hideMyloading();
            // resolve('帅查报告列表');
          },
          error: function (err) {
            hideMyloading();
            console.log(err);
          }
        });
      })
    }

    //获取随访报告列表
    getReportFollow();
    function getReportFollow() {
      return new Promise(function (resolve, reject) {
        $.ajax({
          url: ajaxUrl.reportFollow + '?cardType=01&cardNumber='+ localStorage.getItem('idcard') +'&registerId=' + localStorage.getItem('uid'),
          type: "GET",
          beforeSend: function (request) {
            request.setRequestHeader('token', localStorage.getItem('netToken'));
            request.setRequestHeader('channelCode', localStorage.getItem('channelCode'));
            request.setRequestHeader('lightAppCode', localStorage.getItem('lightAppCode'));
            request.setRequestHeader('appid', localStorage.getItem('appid'));
            request.setRequestHeader('request-id', randomWord(true));
            request.setRequestHeader('timestamp', new Date().getTime());
          },
          success: function (data) {
            console.log('随访报告列表:',data);
            if(data.code === 0){
              $('.tabWrap em:eq(1)').text('('+ data.data.length +')');
              resolve(data.data);
            }else{
              $.toast(data.msg || '请求错误~', 'text');
            }
            hideMyloading();
            // resolve('帅查报告列表');
          },
          error: function (err) {
            hideMyloading();
            console.log(err);
          }
        });
      })
    }

    var html = '';
    var reportData = {
      pageStatus : '筛查报告',
      dataList : $('.followUpReportList'),
      flag : '',
      // loading : false,   //上拉加载时防止多次加载
      // moreData : false,  //是否有更多数据
      // page: 0,  //页数
    };

    indexScreeningReport();
    function indexScreeningReport(){
      getReportScreening().then(function (res) {
        console.log(res);
        var temp1 = $('#screening-Temp').html();
        res.length > 0 ? res.map(function (data) {
          html += temp1.format(data.reportDate, data.doctorName, data.hospitalName, data.peripheralBloodSugar || '', data.venousBloodSugar || '', data.dgtt || '', data.riskFactors || '暂无', data.reportResult || '暂无');
        }) : $('.custom-nodata').show();
        $('.followUpReportList').html(html);
        extendLi();
      }).catch(function (err) {
        hideMyloading();
        console.log(err);
      });
    }

    function indexFollowReport(){
      getReportFollow().then(function (res) {
        console.log(res);
        var temp2 = $('#follow-Temp').html();

        res.length > 0 ? res.map(function (data) {
          var symptomHtml = '';
          data.symptom && data.symptom.map(function (val) {
            symptomHtml += '<span>'+ val +'<br/></span>'
          });
          html += temp2.format(data.folowDate, data.doctorName, data.hospitalName, data.followStyle || '', data.followStatus || '', data.followNextDate || '', symptomHtml || '', data.emptyBloodSugar || '', data.ogtt || '', data.hemoglobin || '', data.advice || '暂无', data.adviceOther || '暂无');
        }) : $('.custom-nodata').show();
        $('.followUpReportList').html(html);
        extendLi();
      }).catch(function (err) {
        hideMyloading();
        console.log(err);
      });
    }

    //判断当前是筛查页面还是随访页面
    $('.tabWrap span').bind('click', function () {
      showMyloading();
      $('.tabWrap span').removeClass();
      $(this).addClass('current');
      if ($(this).text().includes('随访报告')) {
        html = '';
        reportData.pageStatus = '随访报告';
        indexFollowReport()
      } else {
        html = '';
        reportData.pageStatus = '筛查报告';
        indexScreeningReport();
      }
    });

    //点击li标签收起伸展信息，li标签置顶
    function extendLi() {
      var _li = $('.followUpReportList li');
      _li.eq(0).find('.showDetail').show();
      _li.find('.item').bind('click', function () {
        if ($(this).parent().find('.showDetail').css('display') === 'block') {
          $(this).parent().find('.showDetail').slideUp(150);
          $(this).parent().removeClass();
        } else {
          _li.find('.showDetail').slideUp(150);
          $(this).parent().find('.showDetail').slideDown(150);
          _li.removeClass();
          $(this).parent().addClass('showItem');
          $('html,body').animate({scrollTop: $(this).parent().find('.item').outerHeight(true) * $(this).parent().index()}, 150);
        }
      })
    }
  })
</script>

</body>
</html>
