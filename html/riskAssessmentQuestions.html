<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>糖尿病肾病症状评测</title>
  <link rel="stylesheet" type="text/css" href="../lib/css/weui.min.css" />
  <link rel="stylesheet" type="text/css" href="../lib/css/jquery-weui.css" />
  <link rel="stylesheet" type="text/css" href="../custom/css/common.css" />
  <link rel="stylesheet" type="text/css" href="../custom/css/riskAssessment.css" />

</head>

<body>
<div class="riskAssessment riskAssessmentQuestion">
  <form>
    <h2>请勾选符合您情况的选项<em>1/1</em></h2>
    <ul class="listCheckbox kidney" style="display: none;">
      <li class="checked">
          <label class="custom_check_label">
              <input type="checkbox" name="" id="kedney1" value="isHistory" hidden />
              <label for="kedney1" class="icon-check"></label>
              <span class="name">糖尿病糖尿病史超过5年</span>
          </label>
      </li>
      <li>
          <label class="custom_check_label">
              <input type="checkbox" name="" id="kedney2" value="isEyeHistory" hidden />
              <label for="kedney2" class="icon-check"></label>
              <span class="name">有糖尿病眼病史</span>
          </label>
      </li>
      <li>
          <label class="custom_check_label">
              <input type="checkbox" name="" id="kedney3" value="isPressureHistory" hidden />
              <label for="kedney3" class="icon-check"></label>
              <span class="name">有高血压史</span>
          </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="kedney4" value="isUrine" hidden />
          <label for="kedney4" class="icon-check"></label>
          <span class="name">尿中泡沫增多或不易消退</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="kedney5" value="isEdema" hidden />
          <label for="kedney5" class="icon-check"></label>
          <span class="name">反复眼睑或下肢浮肿</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="kedney6" value="isTired" hidden />
          <label for="kedney6" class="icon-check"></label>
          <span class="name">经常感到乏力、易疲劳</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="kedney7" value="isCramp" hidden />
          <label for="kedney7" class="icon-check"></label>
          <span class="name">经常感到腰背酸痛，易抽筋</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="kedney8" value="isNormal" hidden />
          <label for="kedney8" class="icon-check"></label>
          <span class="name">以上症状均无</span>
        </label>
      </li>
    </ul>
    <ul class="listCheckbox eye" style="display: none;">
      <li class="checked">
        <label class="custom_check_label">
          <input type="checkbox" name="" id="eye1" value="isEyeSight" hidden />
          <label for="eye1" class="icon-check"></label>
          <span class="name">有渐进性视力减退</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="eye2" value="isEyeFuzzy" hidden />
          <label for="eye2" class="icon-check"></label>
          <span class="name">视物不清，如隔云烟</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="eye3" value="isEyeShadow" hidden />
          <label for="eye3" class="icon-check"></label>
          <span class="name">眼前有小黑影漂浮</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="eye4" value="isEyeGhosting" hidden />
          <label for="eye4" class="icon-check"></label>
          <span class="name">看东西出现重影</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="eye5" value="isEyeFlash" hidden />
          <label for="eye5" class="icon-check"></label>
          <span class="name">看东西有闪光感</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="eye6" value="isNormal" hidden />
          <label for="eye6" class="icon-check"></label>
          <span class="name">以上症状均无</span>
        </label>
      </li>
    </ul>
    <ul class="listCheckbox foot" style="display: none;">
      <li class="checked">
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot1" value="isHbac" hidden />
          <label for="foot1" class="icon-check"></label>
          <span class="name">最近一次糖化血红蛋白（HBA1C）> 7.0%</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot2" value="isSmoking" hidden />
          <label for="foot2" class="icon-check"></label>
          <span class="name">吸烟</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot3" value="isEyeProblem" hidden />
          <label for="foot3" class="icon-check"></label>
          <span class="name">有视力问题</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot4" value="isKidney" hidden />
          <label for="foot4" class="icon-check"></label>
          <span class="name">有肾脏疾病</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot5" value="isCardiovascular" hidden />
          <label for="foot5" class="icon-check"></label>
          <span class="name">有心血管疾病</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot6" value="isLimbsTemp" hidden />
          <label for="foot6" class="icon-check"></label>
          <span class="name">下肢温度不正常</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot7" value="isLimbsEdema" hidden />
          <label for="foot7" class="icon-check"></label>
          <span class="name">下肢出现水肿（足踝以下、膝关节以下、大腿以下、无）</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot8" value="isDeformity" hidden />
          <label for="foot8" class="icon-check"></label>
          <span class="name">下肢或者足部存在畸形</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot9" value="isFootBeat" hidden />
          <label for="foot9" class="icon-check"></label>
          <span class="name">足部动脉搏动</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot10" value="isShinBeat" hidden />
          <label for="foot10" class="icon-check"></label>
          <span class="name">胫后动脉（内侧踝骨下方可触及）搏动</span>
        </label>
      </li>
      <li>
        <label class="custom_check_label">
          <input type="checkbox" name="" id="foot11" value="isNormal" hidden />
          <label for="foot11" class="icon-check"></label>
          <span class="name">以上症状均无</span>
        </label>
      </li>
    </ul>
    <div class="custom-btm-fixed">
        <span class="custom-btm-btn" onclick="submitData()">提交</span>
    </div>
  </form>
</div>
  <script type="text/javascript" src="../lib/js/flexible.js"></script>
  <script type="text/javascript" src="../lib/js/fastclick.min.js"></script>
  <script type="text/javascript" src="../lib/js/jquery.min.js"></script>
  <script type="text/javascript" src="../custom/js/native.js"></script>
  <script type="text/javascript" src="../custom/js/common.js?v=3.7"></script>
  <script src="../custom/js/api.js"></script>
  <script>
    FastClick.attach(document.body);
    var everyInput = $('ul li input'), riskType = '';
    var lastInput = $('ul li:last-child input'), ajax_url = '', obj = {}, flag = 0;

    function returnBack() {
      NativeFunc({
        ACTION: "CLOSEPAGE",
        PARAM: {
          INDEX: '0'
        }
      });
    }

    function riskData(type, m) {
      switch (type) {
        case '1':
          ajax_url = ajaxUrl.assessmentKidney;
          return obj = {
            isHistory: m,
            isEyeHistory: m,
            isPressureHistory: m,
            isUrine: m,
            isEdema: m,
            isTired: m,
            isCramp: m,
            isNormal: m,
          };
        case '2':
          ajax_url = ajaxUrl.assessmentEye;
          return obj = {
            isEyeSight: m,
            isEyeFuzzy: m,
            isEyeShadow: m,
            isEyeGhosting: m,
            isEyeFlash: m,
            isNormal: m,
          };
        case '3':
          ajax_url = ajaxUrl.assessmentFoot;
          return obj = {
            isHbac: m,
            isSmoking: m,
            isEyeProblem: m,
            isKidney: m,
            isCardiovascular: m,
            isLimbsTemp: m,
            isLimbsEdema: m,
            isDeformity: m,
            isFootBeat: m,
            isShinBeat: m,
            isNormal: m,
          };
        default:
          break;
      }
    }

    function submitData() {
      var ajax_fun = function(data){
        if(data.code === 0){
          console.log(data);
        }else{
          $.toast(data.msg || '请求错误~', 'text');
        }
        hideMyloading();
      };
      custom.ajaxRequest({type: 'POST', url: ajax_url, data: JSON.stringify(Object.assign({}, {registerid: localStorage.getItem('uid')}, obj))}, ajax_fun, false);
      if(flag === 0){
        $.alert('请勾选符合您的选项');
      }else if(obj['isNormal'] === 1){
        $.alert('您本次评估结果尚无糖尿病'+ riskType +'风险，请继续维持健康的生活方式，并定期体检。', returnBack);
      }else{
        $.alert('您本次评估结果具有糖尿病'+ riskType +'风险，建议您到居住地所属社区卫生服务中心进行并发症筛查，及早控制病情。', returnBack);
      }
    }

    $(function () {
      var risk = getParams('risk');
      switch (risk) {
        case '1':
          riskType = '肾病';
          $('.kidney').show();
          break;
        case '2':
          riskType = '眼病';
          $('.eye').show();
          break;
        case '3':
          riskType = '足病';
          $('.foot').show();
          break;
        default:
          break;
      }
      riskData(risk, 0);

      everyInput.bind('click', function () {
        if($(this).prop('checked')){
          flag++;
          if($(this).val() !== 'isNormal'){
            if(obj.hasOwnProperty('isNormal')){
              obj['isNormal'] = 0;
              lastInput.prop('checked', false);
            }
          }else{
            flag = 1;
            everyInput.prop('checked', false);
            $(this).prop('checked', true);
            riskData(risk, 0);
          }
          obj[$(this).val()] = 1;
        }else {
          flag--;
          obj[$(this).val()] = 0;
        }
      });
    })

  </script>
</body>
</html>
